<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [] = toCtest()</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo" id="T37:U1"><span class="autoExtrinsicFcn" id="F2N2:B7">disp</span>(<span class="mxinfo" id="T38:U2"><span class="string">'HW'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo" id="T18:U3"><span class="var type1" id="S3T18U11">states_ids</span> = <span class="mxinfo" id="T18:U5">[1,2,5,6]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T1:U6"><span class="var type1" id="S4T1U20">states</span> = <span class="mxinfo" id="T1:U8">coder.load(<span class="string">'D:/bci/code/SANDBOX/states.mat'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T16:U9"><span class="var type1" id="S6T16U28">QQs</span> = <span class="mxinfo" id="T16:U11">coder.load(<span class="string">'D:/bci/code/SANDBOX/QQs.mat'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo" id="T2:U12"><span class="var type1" id="S7T2U36">states_cur</span> = <span class="mxinfo" id="T2:U14"><span class="var type1" id="S4T1U38">states</span>.states_cur</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo" id="T15:U16"><span class="var type1" id="S8T15U42">indTr</span> = <span class="mxinfo" id="T15:U18">1:fix(length(<span class="var type1" id="S7T2U50">states_cur</span>)/2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T15:U20"><span class="var type1" id="S11T15U54">states_cur_train</span> = <span class="mxinfo" id="T15:U22"><span class="var type1" id="S7T2U56">states_cur</span>(<span class="var type1" id="S8T15U57">indTr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T28:U25"><span class="var type1" id="S12T28U60">QQ</span> = <span class="mxinfo" id="T28:U27"><span class="mxinfo" id="T17:U28"><span class="var type1" id="S6T16U63">QQs</span>.QQ</span>(:,<span class="var type1" id="S8T15U66">indTr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">% states_cur_train = states_cur;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="comment">% QQ_train = QQ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T3:U31"><span class="var type1" id="S13T3U69">Nc</span> = <span class="mxinfo" id="T3:U33">length(<span class="var type1" id="S3T18U72">states_ids</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T19:U35"><span class="var type1" id="S14T19U75">target</span> = <span class="mxinfo" id="T19:U37">zeros(<span class="mxinfo" id="T3:U38"><span class="var type1" id="S13T3U78">Nc</span></span>,<span class="mxinfo" id="T3:U40">size(<span class="var type1" id="S7T2U81">states_cur</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T3U85">c</span> = <span class="mxinfo" id="T39:U43"><span class="mxinfo" id="T3:U44">1</span>:<span class="var type1" id="S13T3U88">Nc</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo" id="T27:U46"><span class="mxinfo" id="T27:U47"><span class="var type1" id="S14T19U92">target</span>(<span class="var type1" id="S17T3U93">c</span>,<span class="mxinfo" id="T27:U50">find(<span class="mxinfo" id="T20:U51"><span class="var type1" id="S11T15U97">states_cur_train</span>==<span class="mxinfo" id="T3:U53"><span class="var type1" id="S3T18U99">states_ids</span>(<span class="var type1" id="S17T3U100">c</span>)</span></span>)</span>)</span>=<span class="mxinfo" id="T3:U56">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T36:U57"><span class="var type1" id="S19T36U104">target_train</span> = <span class="mxinfo" id="T36:U59"><span class="var type1" id="S14T19U106">target</span>(:,<span class="var type1" id="S8T15U108">indTr</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="comment">% target_train = target;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="comment">% clear net2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="var type0" id="S20T0U111">net2</span> = <span class="message error" id="M1F1C">patternnet(<span class="mxinfo" id="T3:U62">15</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo" id="T31:U63"><span class="mxinfo" id="T31:U64"><span class="var type1" id="S20T30U118">net2</span>.divideFcn</span> = <span class="mxinfo" id="T31:U66"><span class="string">'divideind'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo" id="T33:U67"><span class="mxinfo" id="T33:U68"><span class="mxinfo" id="T32:U69"><span class="var type1" id="S20T30U125">net2</span>.divideParam</span>.trainInd</span> = <span class="mxinfo" id="T33:U71"><span class="var type1" id="S8T15U129">indTr</span>(<span class="mxinfo" id="T33:U73"><span class="mxinfo" id="T3:U74">1</span>:<span class="mxinfo" id="T3:U75">2</span>:<span class="mxinfo" id="T3:U76">end</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo" id="T34:U77"><span class="mxinfo" id="T34:U78"><span class="mxinfo" id="T32:U79"><span class="var type1" id="S20T30U140">net2</span>.divideParam</span>.valInd</span> = <span class="mxinfo" id="T34:U81"><span class="var type1" id="S8T15U144">indTr</span>(<span class="mxinfo" id="T34:U83"><span class="mxinfo" id="T3:U84">2</span>:<span class="mxinfo" id="T3:U85">2</span>:<span class="mxinfo" id="T3:U86">end</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo" id="T29:U87"><span class="mxinfo" id="T29:U88"><span class="mxinfo" id="T32:U89"><span class="var type1" id="S20T30U155">net2</span>.divideParam</span>.testInd</span> = <span class="mxinfo" id="T29:U91"><span class="var type1" id="S8T15U161">indTr</span>(end)+1:size(<span class="var type1" id="S12T28U167">QQ</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo" id="T3:U94"><span class="mxinfo" id="T3:U95"><span class="mxinfo" id="T35:U96"><span class="var type1" id="S20T30U173">net2</span>.trainParam</span>.min_grad</span> = <span class="mxinfo" id="T3:U98">1e-7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo" id="T3:U99"><span class="mxinfo" id="T3:U100"><span class="mxinfo" id="T35:U101"><span class="var type1" id="S20T30U181">net2</span>.trainParam</span>.max_fail</span> = <span class="mxinfo" id="T3:U103">30</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo" id="T3:U104"><span class="mxinfo" id="T3:U105"><span class="mxinfo" id="T35:U106"><span class="var type1" id="S20T30U189">net2</span>.trainParam</span>.epochs</span> = <span class="mxinfo" id="T3:U108">5000</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"><span class="message error" id="M2F1C">[<span class="var type0" id="S23T0U196"><span class="message error" id="M3F1C">net1</span></span>,<span class="mxinfo" id="T3:U109"><span class="mxinfo" id="T3:U110"><span class="message error" id="M4F1C">~</span></span></span>] = train(<span class="var type1" id="S20T30U200">net2</span>,<span class="var type1" id="S12T28U201">QQ</span>,<span class="var type1" id="S19T36U202">target_train</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="comment">% save('net','net1');</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"><span class="var type0" id="S25T0U205">Ztrain</span> = <span class="var type0" id="S23T0U207"><span class="message error" id="M5F1C">net1</span></span>(<span class="var type0" id="S12T0U208">QQ</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line">[<span class="mxinfo" id="T3:U114"><span class="mxinfo" id="T3:U115"><span class="message error" id="M7F1C">~</span></span></span>,<span class="var type0" id="S26T0U213"><span class="message error" id="M8F1C">ind</span></span>] = max(<span class="var type0" id="S25T0U216"><span class="message error" id="M6F1C">Ztrain</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"><span class="var type0" id="S28T0U219">states_pred</span> = <span class="var type1" id="S3T18U221">states_ids</span>(<span class="var type0" id="S26T0U222"><span class="message error" id="M9F1C">ind</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line">disp(sum(<span class="var type1" id="S7T2U230">states_cur</span> == <span class="var type0" id="S28T0U231"><span class="message error" id="M10F1C">states_pred</span></span>)/size(<span class="var type0" id="S7T0U234">states_cur</span>,2));</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
